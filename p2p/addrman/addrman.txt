
Probability assumptions 
1. My AddrMan contains around 50,000 addresses (combined across the tried and new tables)
2. Feeler connections are the primary mechanism for testing new addresses.
3. That we primary use timestamps to mark zombie addresses as terrible. 
4. That the other checks inside IsTerrible mostly handle edge cases.(therefore we cant use them to evict a majority of the stale addresses)

Data from my Node for the day 16th october 
Attempted feelers:703
Successful feelers:156
Received addr 1000: 30 


Below is my interpretation of the three conditions that could otherwise help classify addresses as stale.

1. Address older than the horizon (30 days)
if (now - nTime > ADDRMAN_HORIZON)

nTime = first time the address was seen or advertised


This should be the primary stale-address filter


2. Never succeeded + at least 3 attempts
if (m_last_success == 0 && nAttempts >= ADDRMAN_RETRIES)

Most addresses will never reach 3 attempts


With ~50,000 entries, the probability of retrying the same address 3 times is extremely low


3. Last success over a week ago + 10 failed attempts
if (now - m_last_success > ADDRMAN_MIN_FAIL && nAttempts >= ADDRMAN_MAX_FAILURES)

nAttempts counts attempts since last success

Attempting one address 10 times is practically impossible under normal connection conditions




bool AddrInfo::IsTerrible(NodeSeconds now) const
{
    if (now - m_last_try <= 1min) { // never remove things tried in the last minute
        return false;
    }

    if (nTime > now + 10min) { // came in a flying DeLorean
        return true;
    }

    if (now - nTime > ADDRMAN_HORIZON) { // not seen in recent history
        return true;
    }

    if (TicksSinceEpoch<std::chrono::seconds>(m_last_success) == 0 && nAttempts >= ADDRMAN_RETRIES) { // tried N times and never a success
        return true;
    }

    if (now - m_last_success > ADDRMAN_MIN_FAIL && nAttempts >= ADDRMAN_MAX_FAILURES) { // N successive failures in the last week
        return true;
    }

    return false;
}



Given the conditions above, is it possible to add another condition that we can use to mark addresses as terrible?

To do this, a balance needs to be achieved:

A lenient condition will excessively evict addresses, leaving AddrMan empty.

A too strict condition will flood AddrMan, since almost no eviction will occur.


Continuous Scoring for Addresses

I don’t know if this is normally the case, but most addresses are in the new table.

Assuming that feeler connections are the most reliable way to test recent addresses—and given that they occur every 2 minutes—it would take more than 60 days to test all addresses even once.

The goal of continuous scoring is to strike a balance and prevent very old addresses from flooding the AddrMan while avoiding overly aggressive eviction.

My idea is to assign a score to each address, so we can continuously identify stale ones:

Lets combine several factors to be able to determine the score of an address
since nTime is no longer reliable

what can we use to score addresses
1. When we last tried to connect (m_last_try)

Gradual increase can work as follows:

Last tried today → 0.0

Last tried 14 days ago → 0.2

Last tried 30+ days ago → 1.0

2. When we last attempted (m_last_count_attempt)

Gradual increase similar to the above:

Last attempt today → 0.0

Last attempt 14 days ago → 0.2

Last attempt 30+ days ago → 1.0

3. Number of connection failures (nAttempts)

0 failures → 0.0

1 failure → 0.2

3+ failures → 1.0

4. Last successful connection (m_last_success)

Success today → 0.0

Success 30 days ago → 0.2

Success 60+ days ago → 0.8

Never succeeded → 0.1


From this, addresses with the highest scores are considered terrible.

My thinking is: can we use the existing fields and create a condition-check n that is efficient enough for stale addresses?

